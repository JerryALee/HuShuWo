# 如何让计算机智能识别麻将
人脸、指纹、车牌等的智能识别基本都是靠“数字图像处理+模式识别算法”的思路实现的。接下来就用一个有趣的例子——麻将识别，带你了解如何用模板匹配算法实现最简单的智能识别功能。

## 1 用到的素材
首先要像下面的八万这样，收集 9 张饼、9 张条、9 张万、东西南北中发白的模板图片

![](https://static01.imgkr.com/temp/bf09937df737407ab2f37e43122c7b3b.jpg)

然后就是一些待识别的图片，像这样

![](https://static01.imgkr.com/temp/0fc5cb7f243f44858f3786bb6b358b72.jpg)

## 2 图像预处理
不管是模板还是待识别的图片，我们都需要先对图像进行预处理。彩色图像最常用的表示法是RGB（红绿蓝），而颜色对于识别麻将来说不是很重要，因此我们将图像转换为灰度图像。

![](https://static01.imgkr.com/temp/926ad4181b2f4f9c86eaf2a060e4cc51.jpg)

灰度图中每个像素的取值范围都是 0\~255，其中 0 代表黑（最暗），255 代表白（最亮）。为了能够更简单的捕获特征，还需要进一步把图像二值化，也就是把较亮的像素直接取为最亮（255），较暗的像素直接取为最暗（0）。分界值最简单的取法就是取 0\~255 的中间值，也就是 128。当然还有更科学的取法。二值化后就长这样

![](https://static01.imgkr.com/temp/6f8e1ec6505549309c957d5db88d2885.jpg)

之后我们再用边缘检测方法把图像中的所有麻将牌都提取出来，比如这张七万

![](https://static01.imgkr.com/temp/44b502d12abd4c908d70592c3394db25.jpg)

## 3 特征选取
不管是模板还是待识别的图片，我们都将提取到麻将牌部分裁剪成刚好包含文字的样式，并把尺寸缩放成固定的 32 × 48

![](https://static01.imgkr.com/temp/ea435a85bbb640fb8d68a13553e0e3c6.jpg)

## 4 训练模板
将 9 张饼、9 张条、9 张万、东西南北中发白共 34 张模板图片按上述方式处理后，作为模板集，数学上可以表示为 $\{\boldsymbol{c}_i \in \{0, 255\}^{32 \times 48}|i=1, 2, \cdots , 34\}$，其中每个 $\boldsymbol{c}_i$ 代表一张模板牌。将模板集存储下来。

## 5 匹配识别
与上面处理模板图片的方式相同，得到一个尺寸为 32 × 48 像素且刚好包含文字的图像，数学上可以记为 $\{\boldsymbol{x} \in \{0, 255\}^{32 \times 48}\}$。之后，我们把待识别的麻将牌和模板麻将牌进行一一比对。具体来说就是，对待识别的麻将牌和每一张模板麻将牌的所有像素进行比较。由于每个像素点只能是 0（黑）或 255（白），因此，当待识别麻将牌与某一模板麻将牌的像素重合率最高（相同的像素点个数最多）时，就代表待识别麻将牌与该模板最相似。数学上可以表示为
$$
k = \arg\min_i \lVert \boldsymbol{x} - \boldsymbol{c}_i \rVert_1,\ i = 1, 2, \cdots, 34
$$
最终的 $k$ 值就代表识别结果。

## 6 识别效果
让我们看一看这个办法管不管用

![](https://static01.imgkr.com/temp/e0e89a0358c8457d8e8fde6a5474b85b.jpg)

![](https://static01.imgkr.com/temp/fc6744e610bf497586b4ada1155bdd70.jpg)

![](https://static01.imgkr.com/temp/0040445e01d54fafbc570289542af0a8.jpg)

由以上的识别结果我们可以看出，只要拍摄背景与麻将牌之间的区分足够明显，我们就能很准确地识别出麻将的花色和大小。